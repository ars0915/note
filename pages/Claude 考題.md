# DB & Cache
	- ## Q: ä½ åœ¨è¨­è¨ˆä¸€å€‹éŠæˆ²çš„æ’è¡Œæ¦œç³»çµ±ï¼Œéœ€è¦å³æ™‚æ›´æ–°ç©å®¶åˆ†æ•¸ä¸¦é¡¯ç¤º Top 100ã€‚ä½ æœƒé¸æ“‡ Redis çš„å“ªç¨®è³‡æ–™çµæ§‹ï¼Ÿç‚ºä»€éº¼ï¼Ÿ
	- A: ç”¨ ZSET è¨ˆåˆ†æ•¸å’Œæ’åº
	- ## Q: å¦‚æœæˆ‘ç¾åœ¨è¦å¯¦ç¾ä»¥ä¸‹åŠŸèƒ½ï¼Œä½ æœƒç”¨ä»€éº¼ Redis å‘½ä»¤ï¼Ÿ
		- æ›´æ–°ç©å®¶ `player:123` çš„åˆ†æ•¸ç‚º 9527
		- æŸ¥è©¢ Top 10 ç©å®¶ï¼ˆå¾é«˜åˆ°ä½ï¼‰
		- æŸ¥è©¢ç©å®¶ `player:123` çš„æ’å
		- æŸ¥è©¢åˆ†æ•¸åœ¨ 8000-10000 ä¹‹é–“çš„ç©å®¶æ•¸é‡
	- A:
		- ZADD leaderboard 9527 player:123
		- ZREVRANGE leaderboard 0 9 (`ZREVRANGE leaderboard 0 10` - æœƒå›å‚³ **11 å€‹å…ƒç´ **ï¼ˆ0, 1, 2...10ï¼‰)
		- ZREVRANK leaderboard player:123 (`ZSCORE` æœƒå›å‚³åˆ†æ•¸)
		- ZCOUNT leaderboard 8000 10000
	- ## Q: ä½ çš„æ’è¡Œæ¦œç³»çµ±ä¸Šç·šå¾Œï¼Œç™¼ç¾æœ‰å€‹å•é¡Œï¼š
		- æ’è¡Œæ¦œæœ‰ 100 è¬ç©å®¶
		  æ¯ç§’æœ‰ 10,000 æ¬¡æŸ¥è©¢ Top 100
		  Redis é–‹å§‹å‡ºç¾æ•ˆèƒ½å•é¡Œ
		- **å•é¡Œ**ï¼š
			- ç‚ºä»€éº¼ `ZREVRANGE` åœ¨å¤§é‡æŸ¥è©¢æ™‚æœƒè®Šæ…¢ï¼Ÿ
			- ä½ æœƒæ€éº¼å„ªåŒ–é€™å€‹å ´æ™¯ï¼Ÿï¼ˆæç¤ºï¼šçµåˆä½ æ–‡ä»¶ä¸­çš„ã€Œå¿«å–ä¸‰å¤§å•é¡Œã€ï¼‰
	- A:
		- **ZSET ä¸éœ€è¦æ¯æ¬¡é‡æ–°æ’åº**
		- ZSET åº•å±¤ç”¨ **skip list**ï¼ˆè·³è¡¨ï¼‰å¯¦ç¾ï¼Œæœ¬èº«å°±æ˜¯æœ‰åºçš„
		- `ZREVRANGE` çš„æ™‚é–“è¤‡é›œåº¦æ˜¯ **O(log N + M)**
			- log Nï¼šå®šä½åˆ°èµ·å§‹ä½ç½®
			- Mï¼šè¿”å›çš„å…ƒç´ æ•¸é‡ï¼ˆé€™è£¡æ˜¯ 100ï¼‰
		- åœ¨ 100 è¬ç©å®¶çš„æƒ…æ³ä¸‹ï¼Œå–®æ¬¡æŸ¥è©¢ä¸ç®—æ…¢
		- **å•é¡Œåœ¨æ–¼ï¼šæ¯ç§’ 10,000 æ¬¡æŸ¥è©¢ Ã— O(log N + 100) = å£“åŠ›å¤ªå¤§**
		- å„ªåŒ–æ–¹æ³•å¯ä»¥ **å…ˆåœ¨æ‡‰ç”¨å±¤åšä¸€å±¤å¿«å–**
	- ## Q: Top 100 æ˜¯å€‹ç†±é»æ•¸æ“šï¼Œå…·é«”æ€éº¼å¿«å–ï¼Ÿæœƒé‡åˆ°ä»€éº¼å•é¡Œï¼Ÿ
		- é€™æ˜¯ä½ æ–‡ä»¶ä¸­çš„ã€Œ**å¿«å–æ“Šç©¿**ã€å•é¡Œ
		- å¦‚æœ Top 100 çš„å¿«å–éæœŸäº†ï¼Œæœƒç™¼ç”Ÿä»€éº¼ï¼Ÿ
		- æ€éº¼é¿å…ç¬é–“ 10,000 å€‹è«‹æ±‚åŒæ™‚æ‰“åˆ° Redisï¼Ÿ
	- A:
		- ä½¿ç”¨äº’æ–¥é–çš„æ–¹å¼æ‹¿è³‡æ–™ -> é€™æ¨£å°±æŠŠ 10,000 QPS é™åˆ°äº† 1 QPSï¼ˆå° Redis çš„å£“åŠ›ï¼‰ï¼
		- **å¿«å–æ“Šç©¿ï¼ˆCache Breakdownï¼‰**ï¼š**å–®ä¸€ç†±é» key** éæœŸ
			- ä¾‹å¦‚ï¼šTop 100 é€™å€‹ key éæœŸ
			- ç¬é–“ 10,000 å€‹è«‹æ±‚æ‰“åˆ° Redis
		- **å¿«å–é›ªå´©ï¼ˆCache Avalancheï¼‰**ï¼š**å¤§é‡ä¸åŒçš„ key** åŒæ™‚éæœŸ
			- ä¾‹å¦‚ï¼š100 è¬å€‹ç©å®¶è³‡æ–™åŒæ™‚åœ¨æ™šä¸Š 12 é»éæœŸ
			- è§£æ³•æ‰æ˜¯ï¼šéš¨æ©ŸéæœŸæ™‚é–“ã€å¤šå±¤å¿«å–
	- ## Q: è³‡æ–™åº«äº‹å‹™é¡Œ
		- **ä½ åœ¨é–‹ç™¼ä¸€å€‹éŠæˆ²å•†åŸï¼Œç©å®¶è³¼è²·é“å…·çš„æµç¨‹æ˜¯ï¼š**
			- æª¢æŸ¥ç©å®¶é‡‘å¹£æ˜¯å¦è¶³å¤ 
			- æ‰£é™¤é‡‘å¹£
			- æ–°å¢é“å…·åˆ°èƒŒåŒ…
		- **å•é¡Œï¼š**
			- é€™éœ€è¦ä»€éº¼éš”é›¢ç´šåˆ¥ï¼Ÿç‚ºä»€éº¼ï¼Ÿ
			- å¦‚æœç”¨ `Read Committed`ï¼Œæœƒç™¼ç”Ÿä»€éº¼å•é¡Œï¼Ÿ
			- æ€éº¼ç”¨æ¨‚è§€é–å¯¦ç¾é€™å€‹å ´æ™¯ï¼Ÿï¼ˆå¯«å‡ºé—œéµçš„ SQLï¼‰
	- Aï¼š
		- éš”é›¢ç´šåˆ¥ Repeatable Read + SELECT FOR UPDATE
		- å¦‚æœç”¨ Read Committed æœƒæ‹¿åˆ°å…¶ä»–ç­†äº¤æ˜“æ‰£æ¬¾å‰çš„é‡‘é¡è€Œå¯èƒ½æ‰£åˆ°è² æ•¸
		- æ¨‚è§€é– **UPDATE æ™‚æª¢æŸ¥ version**ï¼š
		  ```sql
		  -- æ­¥é©Ÿ 1: è®€å–ï¼ˆä¸åŠ é–ï¼‰
		  SELECT id, gold, version FROM users WHERE id = 123;
		  -- å‡è¨­è®€åˆ°ï¼šgold=500, version=10
		  
		  -- æ­¥é©Ÿ 2: æ¥­å‹™é‚è¼¯æª¢æŸ¥
		  IF gold >= 100 THEN
		      -- æ­¥é©Ÿ 3: æ›´æ–°æ™‚æª¢æŸ¥ versionï¼ˆé—œéµï¼ï¼‰
		      UPDATE users 
		      SET gold = gold - 100, 
		          version = version + 1
		      WHERE id = 123 AND version = 10;  -- â† é—œéµï¼šç¢ºä¿æ²’è¢«æ”¹é
		      
		      -- æ­¥é©Ÿ 4: æª¢æŸ¥å½±éŸ¿è¡Œæ•¸
		      IF affected_rows == 0 THEN
		          -- version ä¸å°ï¼Œè¡¨ç¤ºè¢«åˆ¥äººæ”¹éäº†ï¼Œé‡è©¦ï¼
		          ROLLBACK;
		          RETRY;
		      ELSE
		          INSERT INTO inventory (user_id, item_id) VALUES (123, 456);
		          COMMIT;
		      END IF;
		  END IF;
		  ```
	- ## Q: æ¨‚è§€é– vs æ‚²è§€é–ï¼Œä»€éº¼æ™‚å€™ç”¨å“ªå€‹ï¼Ÿ
		- æç¤ºï¼šæƒ³æƒ³ã€Œè¡çªæ©Ÿç‡ã€å’Œã€Œé‡è©¦æˆæœ¬ã€
	- A:
		- **é—œéµæ˜¯ã€Œè¡çªæ©Ÿç‡ã€ï¼Œä¸æ˜¯ã€Œæµé‡å¤§å°ã€**
			- æ¨‚è§€é–ï¼šé©åˆã€Œè®€å¤šå¯«å°‘ã€è¡çªå°‘ã€
				- ç‚ºä»€éº¼å¯ä»¥ç”¨æ¨‚è§€é–ï¼Ÿ
					- è¡çªæ©Ÿç‡ä½ï¼ˆæˆ‘æ”¹æˆ‘çš„è³‡æ–™ï¼Œä½ æ”¹ä½ çš„è³‡æ–™ï¼‰
					- å³ä½¿é‡è©¦ï¼Œæˆæœ¬ä¹Ÿä¸é«˜
			- æ‚²è§€é–ï¼šé©åˆã€Œå¯«å¤šã€è¡çªå¤šã€
				- ç‚ºä»€éº¼è¦ç”¨æ‚²è§€é–ï¼Ÿ
					- è¡çªæ©Ÿç‡æ¥µé«˜ï¼ˆ1000äººæ¶åŒä¸€å€‹å•†å“ï¼‰
					- ç”¨æ¨‚è§€é–æœƒå°è‡´ 990 äººé‡è©¦ â†’ æµªè²»è³‡æº
					- ä¸å¦‚ç›´æ¥æ’éšŠï¼ˆæ‚²è§€é–ï¼‰
		- **é‡è©¦æˆæœ¬ = å¤±æ•—å¾Œé‡æ–°åŸ·è¡Œçš„ä»£åƒ¹**
			- æ¨‚è§€é–çš„é‡è©¦æµç¨‹ï¼š
			  ```
			  ç¬¬1æ¬¡å˜—è©¦ï¼šè®€DB(10ms) + æ¥­å‹™é‚è¼¯(5ms) + å¯«DBå¤±æ•—(5ms) = 20ms
			  ç¬¬2æ¬¡å˜—è©¦ï¼šè®€DB(10ms) + æ¥­å‹™é‚è¼¯(5ms) + å¯«DBå¤±æ•—(5ms) = 20ms
			  ç¬¬3æ¬¡å˜—è©¦ï¼šè®€DB(10ms) + æ¥­å‹™é‚è¼¯(5ms) + å¯«DBæˆåŠŸ(5ms) = 20ms
			  ç¸½è€—æ™‚ï¼š60ms
			  
			  å¦‚æœè¡çªç‡ 90%ï¼Œå¯èƒ½è¦é‡è©¦ 10 æ¬¡æ‰æˆåŠŸ â†’ 200msï¼
			  ```
			- æ‚²è§€é–çš„ç­‰å¾…ï¼š
			  ```
			  æ’éšŠç­‰å¾…ï¼š100ms
			  åŸ·è¡Œï¼š20ms
			  ç¸½è€—æ™‚ï¼š120msï¼ˆä¸€æ¬¡æˆåŠŸï¼Œä¸é‡è©¦ï¼‰
			  ```
			- åœ¨é«˜è¡çªå ´æ™¯ä¸‹ï¼Œæ‚²è§€é–åè€Œæ›´å¿«ï¼
	- ## Q: ä½ çš„éŠæˆ²æœ‰å€‹ã€Œæ¯æ—¥ç°½åˆ°ã€åŠŸèƒ½ï¼Œ100è¬ç©å®¶æ¯å¤©æ—©ä¸Š8é»åŒæ™‚ç°½åˆ°ã€‚
		- ä½ æœƒç”¨ä»€éº¼è³‡æ–™çµæ§‹å„²å­˜ã€Œä»Šå¤©å·²ç°½åˆ°çš„ç©å®¶ã€ï¼Ÿï¼ˆRedisï¼‰
		- å¦‚ä½•é¿å…å¿«å–é›ªå´©ï¼Ÿï¼ˆ100è¬ç©å®¶çš„ç°½åˆ°è¨˜éŒ„éƒ½åœ¨æ™šä¸Š12é»éæœŸï¼‰
			- ```
			  1. ç©å®¶ç™»å…¥æ™‚è¦é¡¯ç¤ºï¼š
			     - "ä½ ä»Šå¤©é‚„æ²’ç°½åˆ°" 
			     - "ä½ å·²é€£çºŒç°½åˆ° 5 å¤©"
			     
			  2. æ’è¡Œæ¦œï¼š
			     - "é€£çºŒç°½åˆ°å¤©æ•¸ TOP 100"
			     
			  3. çå‹µç³»çµ±ï¼š
			     - "é€£çºŒç°½åˆ° 7 å¤©é€é‘½çŸ³"
			  ```
			  
			  **ç¾åœ¨å•é¡Œä¾†äº†ï¼š**
				- å¦‚æœ 100 è¬ç©å®¶çš„ã€Œé€£çºŒç°½åˆ°å¤©æ•¸ã€éƒ½å¿«å–åœ¨ Redis
				- æ™šä¸Š 12 é»å…¨éƒ¨éæœŸ
				- éš”å¤©æ—©ä¸Š 8 é»ï¼Œ100 è¬ç©å®¶ç™»å…¥
				- éƒ½è¦å¾ DB è®€å– â†’ DB çˆ†ç‚¸ ğŸ’¥
		- å¦‚æœè¦æŸ¥è©¢ã€Œé€£çºŒç°½åˆ°7å¤©çš„ç©å®¶ã€ï¼Œä½ æœƒæ€éº¼è¨­è¨ˆï¼Ÿ
	- A:
		- åªçœ‹ä»Šå¤©å·²ç°½åˆ°çš„ç©å®¶ï¼Œå¯ä»¥ç”¨ Set å­˜å·²ç¶“ç°½åˆ°çš„äºº
		- é¿å…å¿«å–é›ªå´©
			- ```
			  // æ­£ç¢ºç¤ºç¯„ï¼šåŠ ä¸Šéš¨æ©Ÿå€¼ï¼ˆ0-1å°æ™‚ï¼‰
			  randomTTL := 24*time.Hour + time.Duration(rand.Intn(3600))*time.Second
			  redis.Set("user:123:streak", "5", randomTTL)
			  ```
			- ç‚ºä»€éº¼æœ‰æ•ˆï¼Ÿ
				- åŸæœ¬ï¼š100è¬å€‹keyåœ¨ 00:00:00 åŒæ™‚éæœŸ
				- ç¾åœ¨ï¼š100è¬å€‹keyåœ¨ 00:00:00 ~ 01:00:00 ä¹‹é–“åˆ†æ•£éæœŸ
				- DB å£“åŠ›åˆ†æ•£åˆ° 1 å°æ™‚å…§
		- æŸ¥è©¢ã€Œé€£çºŒç°½åˆ°7å¤©ã€
			- æ–¹æ¡ˆ Aï¼šString å­˜é€£çºŒå¤©æ•¸ï¼ˆç°¡å–®ï¼‰
			  ```
			  Key: user:{id}:streak
			  Value: {last_checkin_date}:{streak_days}
			  ```
				- **å„ªé»ï¼š** ç°¡å–®ï¼ŒæŸ¥è©¢å¿«
				- **ç¼ºé»ï¼š** åªçŸ¥é“é€£çºŒå¤©æ•¸ï¼Œä¸çŸ¥é“å…·é«”å“ªå¤©ç°½åˆ°äº†
			- æ–¹æ¡ˆ Bï¼šBitmap å­˜æ¯å¤©çš„ç°½åˆ°ç‹€æ…‹ï¼ˆå½ˆæ€§ï¼‰
			  ```
			  Key: user:{id}:checkin:{year}
			  Value: Bitmapï¼ˆ365 bitsï¼Œæ¯å€‹ bit ä»£è¡¨ä¸€å¤©ï¼‰
			  
			  ä¾‹å¦‚ï¼š
			  user:123:checkin:2024
			  Bit 0 = 1æœˆ1æ—¥ (1 = å·²ç°½åˆ°)
			  Bit 1 = 1æœˆ2æ—¥ (0 = æœªç°½åˆ°)
			  ...
			  Bit 306 = 11æœˆ3æ—¥ (1 = å·²ç°½åˆ°)
			  ```
				- **å„ªé»ï¼š**
					- ç¯€çœç©ºé–“ï¼ˆ365å¤©åªéœ€ 46 bytesï¼‰
					- å¯ä»¥æŸ¥è©¢ã€Œé€™å€‹æœˆç°½åˆ°äº†å¹¾å¤©ã€
					- å¯ä»¥è£œç°½
				- **ç¼ºé»ï¼š** è¨ˆç®—é€£çºŒå¤©æ•¸éœ€è¦å¤šæ¬¡ GetBit
			- | éœ€æ±‚ | æ–¹æ¡ˆ A (String) | æ–¹æ¡ˆ B (Bitmap) |
			  |---|---|---|
			  | åªéœ€é€£çºŒå¤©æ•¸ | âœ… æ¨è–¦ | âŒ å¤ªè¤‡é›œ |
			  | éœ€è¦æŸ¥è©¢æ­·å² | âŒ åšä¸åˆ° | âœ… æ¨è–¦ |
			  | éœ€è¦è£œç°½åŠŸèƒ½ | âŒ åšä¸åˆ° | âœ… æ¨è–¦ |
			  | ç©ºé–“æ•ˆç‡ | æ™®é€š | âœ… æ¥µé«˜ |
	- ## Q: å¦‚æœè¦åšã€Œé€£çºŒç°½åˆ°æ’è¡Œæ¦œã€å‘¢ï¼Ÿ
	- A:
		- éœ€è¦å†åŠ ä¸€å€‹ ZSet
		  ```
		  Key: checkin:leaderboard
		  Value: ZSet {member: userID, score: streakDays}
		  
		  ZADD checkin:leaderboard 7 user:123
		  ZADD checkin:leaderboard 10 user:456
		  
		  æŸ¥è©¢ Top 100ï¼š
		  ZREVRANGE checkin:leaderboard 0 99 WITHSCORES
		  ```
		- | éœ€æ±‚ | æ–¹æ¡ˆ | Redis å‘½ä»¤ |
		  | ---- | ---- | ---- |
		  | **ã€Œæœ¬é€±æ¯å¤©éƒ½ç°½åˆ°çš„äººã€** | âœ… SINTERSTORE | `SINTERSTORE result day1 day2 ... day7` |
		  | **ã€Œé€£çºŒç°½åˆ° 7 å¤©çš„äººã€ï¼ˆä»»æ„æ™‚æ®µï¼‰** | âŒ SINTERSTORE åšä¸åˆ° | éœ€è¦ Bitmap æˆ– String æ–¹æ¡ˆ |
		  | **ã€Œä»Šå¤©ç°½åˆ°çš„äººã€** | âœ… Set | `SMEMBERS checkin:2024-11-03` |
		  | **ã€Œé€£çºŒç°½åˆ°æ’è¡Œæ¦œã€** | âŒ Set åšä¸åˆ° | éœ€è¦ ZSet |
- # MQ & Kafka
	- ## Q1: RabbitMQ å’Œ Kafka çš„æ ¸å¿ƒå·®ç•°æ˜¯ä»€éº¼ï¼Ÿåˆ†åˆ¥é©åˆä»€éº¼å ´æ™¯ï¼Ÿ
	  æç¤ºï¼šå¾è¨­è¨ˆç†å¿µã€è¨Šæ¯æ¨¡å‹ã€ä¿ç•™æ©Ÿåˆ¶ä¾†å›ç­”
	- A:
		- rabbitMQ é©åˆä½å»¶é²ã€ä¿è­‰é€é”å’Œè¤‡é›œè·¯ç”±çš„å ´æ™¯ã€‚kafka é©åˆé«˜ååé‡ã€event sourcingã€è¦æŒä¹…åŒ–çš„å ´æ™¯ã€‚
		- RabbitMQ æ˜¯ **Push æ¨¡å‹**ï¼šBroker ä¸»å‹•æ¨çµ¦ Consumerï¼Œæ¶ˆè²»å¾Œè¨Šæ¯å°±åˆªé™¤
		- Kafka æ˜¯ **Pull æ¨¡å‹**ï¼šConsumer ä¸»å‹•æ‹‰å–ï¼Œè¨Šæ¯ä¿ç•™åœ¨ log ä¸­ï¼Œå¯ä»¥ replay
		- é€™å°±æ˜¯ç‚ºä»€éº¼ Kafka é©åˆ event sourcing - å› ç‚ºéœ€è¦ã€Œé‡æ’­æ­·å²äº‹ä»¶ã€ã€‚
	- ## Q2: å‡è¨­æœ‰ä¸€å€‹ Topic å« user-eventsï¼Œæœ‰ 4 å€‹ partitionsï¼Œç¾åœ¨æœ‰ 3 å€‹ Consumer åœ¨åŒä¸€å€‹ Consumer Group ä¸­æ¶ˆè²»ã€‚è«‹å•ï¼š
		- æ¯å€‹ Consumer æœƒè² è²¬å¹¾å€‹ partitionï¼Ÿ
		  å¦‚æœæ–°å¢ç¬¬ 4 å€‹ Consumerï¼Œæœƒç™¼ç”Ÿä»€éº¼äº‹ï¼Ÿ
		  å¦‚æœæ–°å¢åˆ°ç¬¬ 5 å€‹ Consumerï¼Œæœƒç™¼ç”Ÿä»€éº¼äº‹ï¼Ÿ
		  é€™å€‹éç¨‹ä¸­æœƒè§¸ç™¼ä»€éº¼æ©Ÿåˆ¶ï¼Ÿ
	- A:
		- æ¯å€‹ partition åªèƒ½è¢«ä¸€å€‹consumer æ¶ˆè²»ï¼Œå› æ­¤æœƒæœ‰ä¸€å€‹ consumer è² è²¬2å€‹ partitionï¼Œå…¶ä»–åªè² è²¬ä¸€å€‹ã€‚æ–°å¢ç¬¬å››å€‹ consumer æœƒè®“æ‰€æœ‰ consumer å„æ¶ˆè²»ä¸€å€‹ partitionã€‚æ–°å¢ç¬¬5å€‹æœƒæœ‰ idle consumerã€‚åœ¨æ–°å¢æ™‚æœƒè§¸ç™¼ rebalanceï¼Œç•¶è§¸ç™¼ rebalance æ™‚ï¼Œ**æ‰€æœ‰ consumer éƒ½æœƒåœæ­¢æ¶ˆè²»**ï¼ˆstop-the-worldï¼‰ï¼Œé€™å°±æ˜¯ç‚ºä»€éº¼ rebalance è¢«ç¨±ç‚ºã€Œç½é›£ã€
	- ## Q3: ä½ åœ¨é–‹ç™¼ä¸€å€‹éŠæˆ²å¾Œç«¯çš„æ’è¡Œæ¦œæ›´æ–°ç³»çµ±ï¼Œéœ€è¦ç¢ºä¿ã€ŒåŒä¸€å€‹ç©å®¶çš„åˆ†æ•¸æ›´æ–°ã€æŒ‰ç…§æ™‚é–“é †åºè™•ç†ã€‚
	- A:
		- å› ç‚ºè¦æŒ‰ç…§é †åºè™•ç†ï¼Œæ‰€ä»¥åŒä¸€å€‹ç©å®¶çš„åˆ†æ•¸æ›´æ–°è¦åœ¨åŒä¸€å€‹ partition è£¡ã€‚é€™æ¨£è¨­è¨ˆå¯èƒ½é€ æˆæŸäº› partition ç‰¹åˆ¥å¤š eventã€‚
		- #### Partition ç†±é»è§£æ±ºæ–¹æ¡ˆ
			- **è¤‡åˆ Partition Key**(æ¨è–¦)
			  ```
			  partitionKey := fmt.Sprintf("%s:%d", userID, userID % 10)
			  ```
			  åŒä¸€å€‹ç©å®¶çš„æ›´æ–°é‚„æ˜¯åœ¨åŒä¸€å€‹ partition
			  ä½†ä¸åŒç©å®¶æœƒåˆ†æ•£åˆ°æ›´å¤š partition (ä¸ä¿è­‰é †åº)
			- **æ‡‰ç”¨å±¤èšåˆ** åœ¨ç™¼é€å‰ï¼Œå…ˆåœ¨è¨˜æ†¶é«”ä¸­èšåˆåŒä¸€å€‹ç©å®¶çš„å¤šæ¬¡æ›´æ–°
			- **æ¥å— Trade-off**
			  å°æ–¼æ’è¡Œæ¦œé€™ç¨®å ´æ™¯ï¼Œ**é †åºæ€§ > è² è¼‰å‡è¡¡**ï¼Œæ‰€ä»¥ç†±é»å•é¡Œå¯èƒ½æ˜¯å¯æ¥å—çš„ã€‚åªè¦ï¼š
				- ç›£æ§ç†±é» partition çš„ lag
				- å¿…è¦æ™‚å¢åŠ è©² partition çš„ consumer è™•ç†èƒ½åŠ›
	- ## Q4: Kafka çš„ ISR (In-Sync Replicas) æ˜¯ä»€éº¼ï¼Ÿè«‹èªªæ˜ï¼š
		- ä»€éº¼æƒ…æ³ä¸‹ Follower æœƒè¢«è¸¢å‡º ISRï¼Ÿ
		- `acks=all` å’Œ ISR æœ‰ä»€éº¼é—œä¿‚ï¼Ÿ
		- å¦‚æœ Leader æ›æ‰äº†ï¼ŒKafka æœƒå¾å“ªè£¡é¸æ–°çš„ Leaderï¼Ÿ
	- A:
		- åœ¨ follower è¶…å‡ºæ™‚é–“æ²’åƒ leader fetch æˆ–æ˜¯ offset è½å¾Œå¤ªå¤šå°±æœƒè¢«è¸¢å‡ºã€‚
		- è¨­å®š acks=all éœ€è¦åŒæ­¥åˆ°æ‰€æœ‰ ISR follow å¾Œæ‰æœƒå›å‚³ ackã€‚
		- Leader æ›æ‰æœƒå¾ ISR ä¸­é¸å‡ºæ–°çš„ Leader
	- ## Q5: ä½ çš„åœ˜éšŠåæ‡‰ Kafka Consumer ç¶“å¸¸ç™¼ç”Ÿ rebalanceï¼Œå°è‡´æ¶ˆæ¯è™•ç†å»¶é²ã€‚å¯èƒ½çš„åŸå› æœ‰å“ªäº›ï¼Ÿä½ æœƒå¦‚ä½•å„ªåŒ–ï¼Ÿ
	  æç¤ºï¼šè€ƒæ…® session timeoutã€è™•ç†æ™‚é–“ã€Static Membership ç­‰
	- A:
		- æœ€å¸¸è¦‹çš„ 3 å€‹åŸå› 
			- Consumer è™•ç†æ™‚é–“å¤ªé•·
			  ```go
			  // å•é¡Œï¼šConsumer è™•ç†ä¸€æ‰¹è¨Šæ¯è¶…é max.poll.interval.msï¼ˆé è¨­ 5 åˆ†é˜ï¼‰
			  for msg := range messages {
			      processMessage(msg)  // å¦‚æœé€™å€‹å¾ˆæ…¢...
			  }
			  // â†’ Coordinator èªç‚º Consumer æ›äº† â†’ è§¸ç™¼ rebalance
			  
			  // è§£æ±ºæ–¹æ¡ˆï¼š
			  props.put("max.poll.interval.ms", 600000)  // å¢åŠ åˆ° 10 åˆ†é˜
			  props.put("max.poll.records", 100)         // æ¸›å°‘æ¯æ¬¡æ‹‰å–çš„æ•¸é‡
			  ```
			- session.timeout.ms è¨­å®šå¤ªçŸ­
			  ```go
			  // å•é¡Œï¼šConsumer çš„å¿ƒè·³è¶…æ™‚
			  props.put("session.timeout.ms", 10000)  // 10 ç§’å¤ªçŸ­
			  
			  // è§£æ±ºæ–¹æ¡ˆï¼š
			  props.put("session.timeout.ms", 30000)      // å¢åŠ åˆ° 30 ç§’
			  props.put("heartbeat.interval.ms", 3000)    // å¿ƒè·³é–“éš” 3 ç§’
			  ```
			- Consumer å¯¦ä¾‹é »ç¹å•Ÿå‹•/é—œé–‰
			  ```go
			  // å•é¡Œï¼šéƒ¨ç½²ã€æ“´ç¸®å®¹è§¸ç™¼ rebalance
			  
			  // è§£æ±ºæ–¹æ¡ˆï¼ˆä½ æåˆ°çš„ï¼‰ï¼š
			  props.put("group.instance.id", "consumer-1")  // Static Membership
			  ```
		- å¦å¤–ï¼ŒKafka 2.4+ å¯ä»¥ç”¨ Cooperative Rebalancing æ¸›å°‘ stop-the-world çš„å½±éŸ¿
- # Golang
-
-