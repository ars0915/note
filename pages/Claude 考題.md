# DB & Cache
	- ## Q: 你在設計一個遊戲的排行榜系統，需要即時更新玩家分數並顯示 Top 100。你會選擇 Redis 的哪種資料結構？為什麼？
	- A: 用 ZSET 計分數和排序
	- ## Q: 如果我現在要實現以下功能，你會用什麼 Redis 命令？
		- 更新玩家 `player:123` 的分數為 9527
		- 查詢 Top 10 玩家（從高到低）
		- 查詢玩家 `player:123` 的排名
		- 查詢分數在 8000-10000 之間的玩家數量
	- A:
		- ZADD leaderboard 9527 player:123
		- ZREVRANGE leaderboard 0 9 (`ZREVRANGE leaderboard 0 10` - 會回傳 **11 個元素**（0, 1, 2...10）)
		- ZREVRANK leaderboard player:123 (`ZSCORE` 會回傳分數)
		- ZCOUNT leaderboard 8000 10000
	- ## Q: 你的排行榜系統上線後，發現有個問題：
		- 排行榜有 100 萬玩家
		  每秒有 10,000 次查詢 Top 100
		  Redis 開始出現效能問題
		- **問題**：
			- 為什麼 `ZREVRANGE` 在大量查詢時會變慢？
			- 你會怎麼優化這個場景？（提示：結合你文件中的「快取三大問題」）
	- A:
		- **ZSET 不需要每次重新排序**
		- ZSET 底層用 **skip list**（跳表）實現，本身就是有序的
		- `ZREVRANGE` 的時間複雜度是 **O(log N + M)**
			- log N：定位到起始位置
			- M：返回的元素數量（這裡是 100）
		- 在 100 萬玩家的情況下，單次查詢不算慢
		- **問題在於：每秒 10,000 次查詢 × O(log N + 100) = 壓力太大**
		- 優化方法可以 **先在應用層做一層快取**
	- ## Q: Top 100 是個熱點數據，具體怎麼快取？會遇到什麼問題？
		- 這是你文件中的「**快取擊穿**」問題
		- 如果 Top 100 的快取過期了，會發生什麼？
		- 怎麼避免瞬間 10,000 個請求同時打到 Redis？
	- A:
		- 使用互斥鎖的方式拿資料 -> 這樣就把 10,000 QPS 降到了 1 QPS（對 Redis 的壓力）！
		- **快取擊穿（Cache Breakdown）**：**單一熱點 key** 過期
			- 例如：Top 100 這個 key 過期
			- 瞬間 10,000 個請求打到 Redis
		- **快取雪崩（Cache Avalanche）**：**大量不同的 key** 同時過期
			- 例如：100 萬個玩家資料同時在晚上 12 點過期
			- 解法才是：隨機過期時間、多層快取
	- ## Q: 資料庫事務題
	  **你在開發一個遊戲商城，玩家購買道具的流程是：**
		- 檢查玩家金幣是否足夠
		- 扣除金幣
		- 新增道具到背包
		- **問題：**
			- 這需要什麼隔離級別？為什麼？
			- 如果用 `Read Committed`，會發生什麼問題？
			- 怎麼用樂觀鎖實現這個場景？（寫出關鍵的 SQL）
	-
-